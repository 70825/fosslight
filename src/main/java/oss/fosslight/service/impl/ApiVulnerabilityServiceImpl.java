/*
 * Copyright (c) 2021 LG Electronics Inc.
 * SPDX-License-Identifier: AGPL-3.0-only 
 */

package oss.fosslight.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Service;

import oss.fosslight.repository.ApiVulnerabilityMapper;
import oss.fosslight.service.ApiOssService;
import oss.fosslight.service.ApiVulnerabilityService;

@Service
public class ApiVulnerabilityServiceImpl implements ApiVulnerabilityService {
	/** The api oss mapper. */
	@Autowired Environment env;
	@Autowired ApiVulnerabilityMapper apiVulnerabilityMapper;
	@Autowired ApiOssService apiOssService;
	
	public List<Map<String, Object>> selectNvdList(String product, String version){
		Map<String, Object> paramMap = new HashMap<String, Object>();
		String[] nicknameList = apiOssService.getOssNickNameListByOssName(product);
		
		paramMap.put("ossName", product);
		paramMap.put("ossVersion", version);
		paramMap.put("ossNicknames", nicknameList);
		
		return apiVulnerabilityMapper.selectNvdList(paramMap);
	}
	
	public List<Map<String, Object>> selectMaxScoreNvdInfo(String product, String version){
		Map<String, Object> paramMap = new HashMap<String, Object>();
		
		paramMap.put("ossName", product);
		paramMap.put("ossVersion", version);
		paramMap.put("host", env.getProperty("server.domain"));
		
		return apiVulnerabilityMapper.selectMaxScoreNvdInfo(paramMap);
	}
}